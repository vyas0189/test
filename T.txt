$apiKey = "key_xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx"; $endDate = Get-Date; $startDate = $endDate.AddMonths(-4); $startDateEpoch = [int64](Get-Date $startDate -UFormat %s) * 1000; $endDateEpoch = [int64](Get-Date $endDate -UFormat %s) * 1000; $base64Auth = [Convert]::ToBase64String([Text.Encoding]::ASCII.GetBytes("${apiKey}:")); $headers = @{ "Authorization" = "Basic $base64Auth"; "Content-Type" = "application/json" }; $allEvents = @(); $currentPage = 1; $pageSize = 1000; do { $body = @{ startDate = $startDateEpoch; endDate = $endDateEpoch; pageSize = $pageSize; page = $currentPage } | ConvertTo-Json; Write-Host "Fetching page $currentPage..."; $response = Invoke-RestMethod -Uri "https://api.cursor.com/teams/filtered-usage-events" -Method Post -Headers $headers -Body $body; $allEvents += $response.usageEvents; $currentPage++; if ($response.pagination.hasNextPage) { Write-Host "Waiting 3 seconds before next request..."; Start-Sleep -Seconds 3 } } while ($response.pagination.hasNextPage); Write-Host "Fetched all $($allEvents.Count) events from $($currentPage - 1) pages"; $allEvents | Export-Csv -Path "cursor_usage_last_4_months.csv" -NoTypeInformation; Write-Host "Exported $($allEvents.Count) usage events to cursor_usage_last_4_months.csv"
